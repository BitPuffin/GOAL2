/* code that might get turned into tests later on if I add a test suite */
/* for now that's not much of a concern                                 */


/* testing the add instruction for the unsafevm */
void test_add() {
	struct unsafevm vm = {};
	struct instruction adds[3] =
		{
			{
				OP_ADD_INT,
				2,
				{ { MODE_REG, REG_0 }, { MODE_REG, REG_2 } }
			},
			{
				OP_ADD_INT,
				2,
				{ { MODE_REG, REG_0 }, { MODE_REG, REG_2 } }
			},
			{
				OP_ADD_INT,
				2,
				{ { MODE_REG, REG_0 }, { MODE_REG, REG_2 } }
			}
		};
	vm.registers[REG_0] = 15;
	vm.registers[REG_2] = 17;
	vm.iptr = adds;
	printf("before: {r0: %d} {r2: %d}\n",
	       (int) vm.registers[REG_0],
	       (int) vm.registers[REG_2]);

	advance_instruction(&vm);

	printf("after:  {r0: %d} {r2: %d}\n",
	       (int) vm.registers[REG_0],
	       (int) vm.registers[REG_2]);
	vm.registers[REG_0] = 1;
	advance_instruction(&vm);

	printf("after:  {r0: %d} {r2: %d}\n",
	       (int) vm.registers[REG_0],
	       (int) vm.registers[REG_2]);
	vm.registers[REG_0] = 2;
	advance_instruction(&vm);

	printf("after:  {r0: %d} {r2: %d}\n",
	       (int) vm.registers[REG_0],
	       (int) vm.registers[REG_2]);
}



/* test push instruction */
/* sp, spa, sv were      */
/* checked in debugger   */
void test_push() {
	struct unsafevm vm = inituvm();
	struct instruction i = {
		OPC_PUSH,
		1,
		{ MODE_REG, REG_0 }
	};
	vm.registers[REG_0] = 1337;
	u64 sp = vm.registers[REG_SP];
	vm.iptr = &i;
	advance_instruction(&vm);
	u64 spa = vm.registers[REG_SP];
	u64 *sv = (u64 *)spa;
	
	destroyvm(vm);
}
